                                                                                                                                                                                                                                                                                                                                                   QUERY PLAN                                                                                                                                                                                                                                                                                                                                                   
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Aggregate  (cost=511669.15..511669.16 rows=1 width=8) (actual time=2141.417..2141.426 rows=1 loops=1)
   Buffers: shared hit=166226 read=45350
   ->  Nested Loop  (cost=7083.51..511669.14 rows=4 width=0) (actual time=413.728..2141.100 rows=1646 loops=1)
         Buffers: shared hit=166226 read=45350
         ->  Hash Join  (cost=7083.08..511657.54 rows=5 width=4) (actual time=413.669..2080.517 rows=1646 loops=1)
               Hash Cond: (ci.role_id = rt.id)
               Buffers: shared hit=161951 read=43041
               ->  Nested Loop  (cost=7081.85..511656.27 rows=14 width=8) (actual time=413.437..2079.257 rows=4787 loops=1)
                     Buffers: shared hit=161950 read=43041
                     ->  Nested Loop  (cost=7081.41..511612.53 rows=1 width=12) (actual time=413.376..2010.569 rows=157 loops=1)
                           Buffers: shared hit=161053 read=38812
                           ->  Nested Loop  (cost=7081.41..511610.11 rows=1 width=16) (actual time=413.366..2008.154 rows=157 loops=1)
                                 Buffers: shared hit=160896 read=38812
                                 ->  Nested Loop  (cost=7081.41..511607.69 rows=1 width=20) (actual time=413.346..2004.539 rows=157 loops=1)
                                       Buffers: shared hit=160739 read=38812
                                       ->  Hash Join  (cost=7080.98..424674.67 rows=2035 width=12) (actual time=35.497..940.217 rows=8068 loops=1)
                                             Hash Cond: (t.kind_id = kt.id)
                                             Buffers: shared hit=73917 read=12348
                                             ->  Nested Loop  (cost=7079.84..424653.53 rows=4747 width=16) (actual time=28.362..936.172 rows=12452 loops=1)
                                                   Buffers: shared hit=73916 read=12348
                                                   ->  Bitmap Heap Scan on movie_info mi1  (cost=7079.40..377309.22 rows=6784 width=8) (actual time=28.312..268.795 rows=19761 loops=1)
                                                         Recheck Cond: (info_type_id = 18)
                                                         Filter: ((info)::text = ANY ('{"Agoura Hills, California, USA","Culver City, California, USA","Estudios Churubusco Azteca, Mexico City, Distrito Federal, Mexico","Lancaster, California, USA","Leipzig, Saxony, Germany","Massachusetts, USA","New York City, New York, USA","Royal Palace, Caserta, Campania, Italy","Stage 12, Universal Studios - 100 Universal City Plaza, Universal City, California, USA","Stage 43, Universal Studios - 100 Universal City Plaza, Universal City, California, USA","Studio Babelsberg, Potsdam, Brandenburg, Germany","Tower Theatre - 802 S. Broadway, Downtown, Los Angeles, California, USA",UK}'::text[]))
                                                         Rows Removed by Filter: 641162
                                                         Heap Blocks: exact=6972
                                                         Buffers: shared hit=2569 read=4923
                                                         ->  Bitmap Index Scan on info_type_id_movie_info  (cost=0.00..7077.68 rows=662032 width=0) (actual time=26.721..26.721 rows=660923 loops=1)
                                                               Index Cond: (info_type_id = 18)
                                                               Buffers: shared hit=1 read=519
                                                   ->  Memoize  (cost=0.44..7.03 rows=1 width=8) (actual time=0.033..0.033 rows=1 loops=19761)
                                                         Cache Key: mi1.movie_id
                                                         Cache Mode: logical
                                                         Hits: 68  Misses: 19693  Evictions: 0  Overflows: 0  Memory Usage: 1792kB
                                                         Buffers: shared hit=71347 read=7425
                                                         ->  Index Scan using title_pkey on title t  (cost=0.43..7.02 rows=1 width=8) (actual time=0.032..0.032 rows=1 loops=19693)
                                                               Index Cond: (id = mi1.movie_id)
                                                               Filter: ((production_year <= 2015) AND (production_year >= 1990))
                                                               Rows Removed by Filter: 0
                                                               Buffers: shared hit=71347 read=7425
                                             ->  Hash  (cost=1.10..1.10 rows=3 width=4) (actual time=0.024..0.025 rows=3 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 9kB
                                                   Buffers: shared hit=1
                                                   ->  Seq Scan on kind_type kt  (cost=0.00..1.10 rows=3 width=4) (actual time=0.013..0.016 rows=3 loops=1)
                                                         Filter: ((kind)::text = ANY ('{movie,"tv movie","video game"}'::text[]))
                                                         Rows Removed by Filter: 4
                                                         Buffers: shared hit=1
                                       ->  Index Scan using movie_id_movie_info on movie_info mi2  (cost=0.43..42.71 rows=1 width=8) (actual time=0.131..0.132 rows=0 loops=8068)
                                             Index Cond: (movie_id = t.id)
                                             Filter: ((info_type_id = 16) AND ((info)::text = ANY ('{"Australia:14 October 2004","Canada:27 September 2005","Hungary:10 April 2004","Norway:11 May 2004","Portugal:10 October 2005","Sweden:24 January 2004",USA:2004,USA:2008,USA:2009,USA:2011,"USA:5 September 2001"}'::text[])))
                                             Rows Removed by Filter: 35
                                             Buffers: shared hit=86822 read=26464
                                 ->  Seq Scan on info_type it1  (cost=0.00..2.41 rows=1 width=4) (actual time=0.013..0.019 rows=1 loops=157)
                                       Filter: (id = 18)
                                       Rows Removed by Filter: 112
                                       Buffers: shared hit=157
                           ->  Seq Scan on info_type it2  (cost=0.00..2.41 rows=1 width=4) (actual time=0.006..0.013 rows=1 loops=157)
                                 Filter: (id = 16)
                                 Rows Removed by Filter: 112
                                 Buffers: shared hit=157
                     ->  Index Scan using movie_id_cast_info on cast_info ci  (cost=0.44..43.35 rows=38 width=12) (actual time=0.052..0.428 rows=30 loops=157)
                           Index Cond: (movie_id = t.id)
                           Buffers: shared hit=897 read=4229
               ->  Hash  (cost=1.18..1.18 rows=4 width=4) (actual time=0.040..0.041 rows=4 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 9kB
                     Buffers: shared hit=1
                     ->  Seq Scan on role_type rt  (cost=0.00..1.18 rows=4 width=4) (actual time=0.029..0.033 rows=4 loops=1)
                           Filter: ((role)::text = ANY ('{composer,"miscellaneous crew",producer,writer}'::text[]))
                           Rows Removed by Filter: 8
                           Buffers: shared hit=1
         ->  Index Scan using name_pkey on name n  (cost=0.43..2.32 rows=1 width=4) (actual time=0.036..0.036 rows=1 loops=1646)
               Index Cond: (id = ci.person_id)
               Filter: (((gender)::text = ANY ('{f,m}'::text[])) OR (gender IS NULL))
               Buffers: shared hit=4275 read=2309
 Planning:
   Buffers: shared hit=576 read=1
 Planning Time: 15.734 ms
 Execution Time: 2142.488 ms
(77 rows)

